# PVZ Service

Бэкенд-сервис для управления пунктами выдачи заказов с системой авторизации, приёмкой товаров и gRPC-интеграцией.

### Запуск
```bash
docker-compose up -d --build
```

## Реализованный функционал

### 1. Авторизация через dummyLogin

- Метод получения тестового токена:  
  `POST /dummyLogin`  
  Укажите тип пользователя: `client` или `moderator`  
  Сервис вернёт токен с соответствующим уровнем доступа

### 2. Регистрация и авторизация пользователей

- Регистрация по email и паролю:  
  `POST /register`

- Авторизация, возвращает токен доступа:  
  `POST /login`

### 3. Заведение ПВЗ

- Доступно только модераторам
- Создание ПВЗ возможно только в городах:
  - Москва
  - Санкт-Петербург
  - Казань
- Endpoint:  
  `POST /pvz`

### 4. Приёмка товаров

- Запуск приёмки — только для сотрудников ПВЗ
- Нельзя создать новую приёмку, пока предыдущая не закрыта
- Endpoint:  
  `POST /receptions`

### 5. Добавление товаров

- Доступно только авторизованным сотрудникам ПВЗ
- Товар автоматически привязывается к последней незакрытой приёмке текущего ПВЗ
- Endpoint:  
  `POST /products`

### 6. Удаление товаров

- Удаление по принципу LIFO
- Доступно только в рамках незакрытой приёмки
- Endpoint:  
  `POST /pvz/{pvzId}/delete_last_product`

### 7. Закрытие приёмки

- Доступно только сотрудникам ПВЗ
- После закрытия приёмки изменения недопустимы
- Endpoint:  
  `POST /pvz/{pvzId}/close_last_reception`

### 8. Получение данных

- Получение списка ПВЗ с информацией о них
- Поддерживается пагинация и фильтрация по дате приёмки
- Endpoint:  
  `GET /pvz`

## Дополнительные реализованные задачи

### 1. Полноценная система авторизации
- Регистрация и вход по email и паролю
- Пользователи сохраняются в базе данных
- Метод `/dummyLogin` также доступен для тестирования

### 2. gRPC-сервис для получения списка ПВЗ

- Запущен gRPC-сервер на порту `3000`
- Возвращает все ПВЗ, добавленные в систему
- Авторизация не требуется

## Тестирование

- Код покрыт unit-тестами более чем на 75%
- Реализован интеграционный тест, выполняющий последовательность действий:
  1. Создание нового ПВЗ
  2. Добавление новой приёмки заказов
  3. Добавление 50 товаров в рамках текущей приёмки
  4. Закрытие приёмки заказов

## Технологический стек

- **Язык**: Go
- **База данных**: PostgreSQL
- **Контейнеризация**: Docker & DockerCompose
- **Протоколы**: HTTP/REST, gRPC
- **Аутентификация**: JWT
